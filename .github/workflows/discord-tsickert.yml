name: Discord (tsickert) on push
on: { push: {} }

jobs:
  tsickert:
    runs-on: ubuntu-latest
    env:
      LOREM_LENGTH: ${{ vars.LOREM_LENGTH }}
      DISCORD_HOOK: ${{ secrets.DISCORD_HOOK }}
    steps:
      - name: Build lorem and payload.json (embed with ```text)
        run: |
          python3 - <<'PY'
          import os, json
          n = int(os.environ["LOREM_LENGTH"])
          base = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. "
          s = (base * ((n // len(base)) + 2))[:n]
          payload = {
          "embeds": [{
            "title": "Lorem sample (tsickert)",
            "description": f"```text\n{s}\n```"
          }]
          }
          open("payload.json","w",encoding="utf-8").write(json.dumps(payload, ensure_ascii=False))
          PY
      - name: Send via tsickert/discord-webhook
        uses: tsickert/discord-webhook@v7
        with:
          webhook-url: ${{ env.DISCORD_HOOK }}
          raw-data: payload.json
          wait: true
