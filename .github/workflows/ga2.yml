name: Discord Lorem (push) embed version
on:
  push:

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Generate lorem and post to Discord (as embed)
        shell: bash
        env:
          LOREM_LENGTH: ${{ vars.LOREM_LENGTH }}
          DISCORD_HOOK: ${{ secrets.DISCORD_HOOK }}
        run: |
          set -euo pipefail

          python3 - <<'PY'
          import os, json
          n = int(os.environ["LOREM_LENGTH"])
          base = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, consectetur alaki palaki adipiscing elit. "
          s = (base * ((n // len(base)) + 2))[:n]

          s = s[:4084]

          payload = {
            "embeds": [{
              "type": "rich",
              "title": "Lorem sample (embed)",
              "description": f"```text\n{s}\n```"
            }]
          }
          open("payload.json","w",encoding="utf-8").write(
            json.dumps(payload, ensure_ascii=False, separators=(",",":"))
          )
          PY

          resp="$(curl -sS -f -H "Content-Type: application/json" \
                    --data-binary @payload.json "$DISCORD_HOOK?wait=true")"

          echo "::notice::Discord response: $resp"
